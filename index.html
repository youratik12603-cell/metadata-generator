<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atik - AI Metadata Generator</title>
    <style>
        /* বেসিক ডিজাইন */
        body { font-family: sans-serif; background-color: #1a1a1a; color: white; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: #2d2d2d; padding: 20px; border-radius: 10px; }
        h1 { text-align: center; color: #ff6b6b; }
        
        /* ইনপুট স্টাইল */
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="file"] { width: 100%; padding: 10px; border-radius: 5px; border: none; }
        button { width: 100%; padding: 15px; background: #ff6b6b; color: white; border: none; font-size: 16px; cursor: pointer; border-radius: 5px; margin-top: 10px; }
        button:hover { background: #ff4757; }
        button:disabled { background: #555; cursor: not-allowed; }

        /* প্রিভিউ এবং আউটপুট */
        #imagePreview { max-width: 100%; height: auto; margin-top: 10px; display: none; border-radius: 5px; }
        .output-area { margin-top: 20px; background: #000; padding: 15px; border-radius: 5px; display: none; }
        .output-item { margin-bottom: 10px; }
        .output-label { color: #aaa; font-size: 12px; }
        textarea { width: 100%; background: #222; color: #0f0; border: 1px solid #444; padding: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1>Atik Metadata Generator</h1>

    <!-- ১. API Key ইনপুট -->
    <div class="input-group">
        <label>Enter Google Gemini API Key:</label>
        <input type="text" id="apiKey" placeholder="Paste your API Key here...">
    </div>

    <!-- ২. ছবি আপলোড -->
    <div class="input-group">
        <label>Upload Image:</label>
        <input type="file" id="imageInput" accept="image/*">
        <img id="imagePreview" src="" alt="Preview">
    </div>

    <!-- ৩. জেনারেট বাটন -->
    <button id="generateBtn" onclick="generateMetadata()">Generate Metadata</button>
    <p id="status" style="text-align: center; color: yellow;"></p>

    <!-- ৪. আউটপুট এরিয়া -->
    <div id="outputArea" class="output-area">
        <div class="output-item">
            <span class="output-label">Title:</span>
            <textarea id="outTitle" rows="2"></textarea>
        </div>
        <div class="output-item">
            <span class="output-label">Description:</span>
            <textarea id="outDesc" rows="4"></textarea>
        </div>
        <div class="output-item">
            <span class="output-label">Keywords:</span>
            <textarea id="outKeywords" rows="6"></textarea>
        </div>
    </div>
</div>

<script>
    // লজিক শুরু
    let base64Image = "";

    // ছবি সিলেক্ট করলে প্রিভিউ দেখাবে এবং Base64 এ কনভার্ট করবে
    document.getElementById('imageInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(evt) {
                base64Image = evt.target.result.split(',')[1]; // শুধু ডাটা অংশটুকু নেওয়া
                const preview = document.getElementById('imagePreview');
                preview.src = evt.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    });

    // মেইন ফাংশন - যা API কল করবে
    async function generateMetadata() {
        const apiKey = document.getElementById('apiKey').value;
        const status = document.getElementById('status');
        const generateBtn = document.getElementById('generateBtn');

        // ভ্যালিডেশন
        if (!apiKey) { alert("Please enter API Key!"); return; }
        if (!base64Image) { alert("Please upload an image!"); return; }

        // লোডিং শুরু
        status.innerText = "Generating metadata... Please wait.";
        generateBtn.disabled = true;

        // Gemini API এর প্রম্পট (ভিডিওর মতো লজিক)
        const promptText = `
            Act as a professional stock photographer. Analyze this image and provide:
            1. A catchy Title (max 80 chars).
            2. A detailed Description (min 150 chars).
            3. 50 relevant Keywords separated by commas.
            
            Return the result in strictly JSON format like this:
            {
                "title": "...",
                "description": "...",
                "keywords": "..."
            }
        `;

        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;

        const payload = {
            contents: [{
                parts: [
                    { text: promptText },
                    { inline_data: { mime_type: "image/jpeg", data: base64Image } }
                ]
            }]
        };

        try {
            const response = await fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            const data = await response.json();

            // রেসপন্স হ্যান্ডলিং
            if (data.error) {
                throw new Error(data.error.message);
            }

            // টেক্সট বের করা এবং JSON পার্স করা
            const rawText = data.candidates[0].content.parts[0].text;
            // কোড ব্লক ক্লিন করা (যদি AI markdown দেয়)
            const cleanJson = rawText.replace(/```json|```/g, '').trim();
            const metadata = JSON.parse(cleanJson);

            // আউটপুট বক্সে দেখানো
            document.getElementById('outTitle').value = metadata.title;
            document.getElementById('outDesc').value = metadata.description;
            document.getElementById('outKeywords').value = metadata.keywords;

            document.getElementById('outputArea').style.display = 'block';
            status.innerText = "Success! Metadata Generated.";

        } catch (error) {
            console.error(error);
            status.innerText = "Error: " + error.message;
            alert("Failed to generate. Check Console for details.");
        } finally {
            generateBtn.disabled = false;
        }
    }
</script>

</body>
</html>
